#!/bin/bash

# kubctl-0x02 - Blue/Green deployment script for Django app

set -e

echo "ğŸš€ Deploying BLUE version..."
kubectl apply -f messaging_app/blue_deployment.yaml

echo "ğŸŸ¢ Deploying GREEN version (new)..."
kubectl apply -f messaging_app/green_deployment.yaml

echo "â³ Waiting 10s for pods to initialize..."
sleep 10

echo "ğŸ” Checking logs from GREEN pods:"
GREEN_PODS=$(kubectl get pods -l version=green -o name)

for pod in $GREEN_PODS; do
  echo "Logs for $pod:"
  kubectl logs $pod
done

echo "ğŸ¯ Switching traffic to GREEN version..."
kubectl apply -f messaging_app/kubeservice.yaml

echo "âœ… Traffic is now routed to the GREEN deployment."
